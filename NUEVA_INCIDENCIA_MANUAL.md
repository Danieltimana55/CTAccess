# ‚úÖ Nueva Incidencia Manual - M√≥dulo Incidencias

## üéØ Funcionalidad Implementada

Ahora los **administradores** y **celadores** pueden reportar incidencias manualmente desde la interfaz web con un modal completo y profesional.

### ‚ú® Caracter√≠sticas:

1. ‚úÖ **Bot√≥n "Nueva Incidencia"** en el header (rojo, color de alerta)
2. ‚úÖ **Modal con formulario completo**
3. ‚úÖ **Selecci√≥n de acceso activo** (requerido, carga autom√°tica)
4. ‚úÖ **Selecci√≥n de tipo** con iconos (seguridad, acceso, equipamiento, comportamiento, otro)
5. ‚úÖ **Selecci√≥n de prioridad visual** con botones radiales (alta, media, baja)
6. ‚úÖ **Descripci√≥n detallada** (textarea grande)
7. ‚úÖ **Validaciones backend** completas
8. ‚úÖ **Dise√±o responsive** y consistente

---

## üì∏ Vista del Modal

```
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ   ‚ö†Ô∏è  Nueva Incidencia                           ‚úï   ‚îÉ
‚î£‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´
‚îÉ                                                       ‚îÉ
‚îÉ   üë§ Acceso Relacionado *                             ‚îÉ
‚îÉ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÉ
‚îÉ   ‚îÇ Seleccionar acceso...                    ‚ñº  ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ Juan P√©rez - 14 oct, 06:02 PM | üíª      ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ Mar√≠a Garc√≠a - 14 oct, 03:15 PM | üöó     ‚îÇ   ‚îÉ
‚îÉ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÉ
‚îÉ                                                       ‚îÉ
‚îÉ   üè∑Ô∏è Tipo *                                           ‚îÉ
‚îÉ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÉ
‚îÉ   ‚îÇ Seleccionar tipo...                      ‚ñº  ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ üõ°Ô∏è Seguridad                               ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ üîë Acceso                                  ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ üîß Equipamiento                            ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ üë§ Comportamiento                          ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ ‚Ä¢ üìã Otro                                    ‚îÇ   ‚îÉ
‚îÉ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÉ
‚îÉ                                                       ‚îÉ
‚îÉ   üö© Prioridad *                                      ‚îÉ
‚îÉ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÉ
‚îÉ   ‚îÇ    ‚ÑπÔ∏è    ‚îÇ    ‚ö†Ô∏è    ‚îÇ    üö®    ‚îÇ                   ‚îÉ
‚îÉ   ‚îÇ  Baja   ‚îÇ  Media  ‚îÇ  Alta   ‚îÇ                   ‚îÉ
‚îÉ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÉ
‚îÉ      Verde    Amarillo   Rojo                        ‚îÉ
‚îÉ                                                       ‚îÉ
‚îÉ   üìù Descripci√≥n *                                    ‚îÉ
‚îÉ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÉ
‚îÉ   ‚îÇ Describe detalladamente la incidencia...    ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ                                              ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ                                              ‚îÇ   ‚îÉ
‚îÉ   ‚îÇ                                              ‚îÇ   ‚îÉ
‚îÉ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÉ
‚îÉ                                                       ‚îÉ
‚îÉ   ‚ÑπÔ∏è  Registro de incidencia                          ‚îÉ
‚îÉ   Esta incidencia se asociar√° al acceso              ‚îÉ
‚îÉ   seleccionado y ser√° visible para todo el           ‚îÉ
‚îÉ   personal autorizado. La prioridad determinar√°      ‚îÉ
‚îÉ   el orden de atenci√≥n.                              ‚îÉ
‚îÉ                                                       ‚îÉ
‚îÉ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÉ
‚îÉ   ‚îÇ   Cancelar   ‚îÇ  ‚îÇ  ‚ö†Ô∏è Reportar Incidencia  ‚îÇ   ‚îÉ
‚îÉ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÉ
‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
```

---

## üîÑ Flujo de Funcionamiento

### **1. Usuario hace click en "Nueva Incidencia"**
```
1. Se abre el modal
2. Se cargan autom√°ticamente los accesos activos
3. Prioridad prellenada en "media"
```

### **2. Usuario selecciona un acceso activo**
```
1. Lista muestra persona, fecha de entrada
2. Incluye iconos si tiene port√°til (üíª) o veh√≠culo (üöó)
3. Solo muestra accesos en estado "activo"
```

### **3. Usuario selecciona tipo de incidencia**
```
Opciones con iconos:
‚Ä¢ üõ°Ô∏è Seguridad - Para problemas de seguridad
‚Ä¢ üîë Acceso - Para problemas de entrada/salida
‚Ä¢ üîß Equipamiento - Para problemas con equipos
‚Ä¢ üë§ Comportamiento - Para conductas inapropiadas
‚Ä¢ üìã Otro - Para otros casos
```

### **4. Usuario selecciona prioridad (visual)**
```
Botones radiales con colores:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ‚ÑπÔ∏è     ‚îÇ   ‚ö†Ô∏è     ‚îÇ   üö®     ‚îÇ
‚îÇ  BAJA   ‚îÇ  MEDIA  ‚îÇ  ALTA   ‚îÇ
‚îÇ  Verde  ‚îÇ Amarillo‚îÇ  Rojo   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **5. Usuario escribe la descripci√≥n**
```
Textarea amplio (4 l√≠neas) para detalles completos
Placeholder: "Describe detalladamente la incidencia..."
M√°ximo: 1000 caracteres
```

### **6. Usuario hace click en "Reportar Incidencia"**
```
1. Se validan los datos
2. Se crea la incidencia
3. Se asocia al acceso seleccionado
4. Se registra qui√©n la report√≥
5. Se cierra el modal
6. Se actualiza la tabla autom√°ticamente
7. Se muestra mensaje de √©xito
```

---

## üìÅ Archivos Modificados

### **1. Frontend (Vue)**
**Archivo**: `resources/js/Pages/System/Celador/Incidencias/Index.vue`

**Cambios realizados**:
```diff
+ import Modal from '@/Components/Modal.vue'
+ import { useForm } from '@inertiajs/vue3'
+ import axios from 'axios'

+ // Estado del modal
+ const showModal = ref(false)
+ const accesos = ref([])
+ const loadingAccesos = ref(false)

+ // Formulario
+ const form = useForm({
+   acceso_id: '',
+   tipo: '',
+   prioridad: 'media',
+   descripcion: '',
+ })

+ // Funciones
+ const openCreateModal = async () => { ... }
+ const loadAccesos = async () => { ... }
+ const submit = () => { ... }

+ // Bot√≥n en el header (rojo)
+ <button @click="openCreateModal" class="bg-red-600">
+   Nueva Incidencia
+ </button>

+ // Modal completo con formulario
+ <Modal :show="showModal" @close="closeModal">...</Modal>
```

**Caracter√≠sticas del formulario**:
- Select de accesos activos (carga din√°mica)
- Select de tipo con iconos
- Botones radiales para prioridad (visual)
- Textarea grande para descripci√≥n
- Validaciones en tiempo real
- Estados de carga

---

### **2. Backend (Controller)**
**Archivo**: `app/Http/Controllers/System/Celador/IncidenciaController.php`

**Nuevos imports**:
```php
use App\Models\Acceso;
use Illuminate\Support\Facades\Auth;
```

**Nuevos m√©todos**:

#### `getAccesosActivos()` - Obtener accesos activos
```php
public function getAccesosActivos()
{
    $accesos = Acceso::with(['persona', 'portatil', 'vehiculo'])
        ->where('estado', 'activo')
        ->latest('fecha_entrada')
        ->get()
        ->map(function ($acceso) {
            return [
                'id' => $acceso->id,
                'persona_nombre' => $acceso->persona->Nombre ?? 'Sin nombre',
                'persona_documento' => $acceso->persona->documento ?? '',
                'fecha_entrada' => $acceso->fecha_entrada,
                'portatil_serial' => $acceso->portatil->serial ?? null,
                'vehiculo_placa' => $acceso->vehiculo->placa ?? null,
            ];
        });

    return response()->json(['accesos' => $accesos]);
}
```

#### `store()` - Crear nueva incidencia
```php
public function store(Request $request)
{
    $validated = $request->validate([
        'acceso_id' => ['required', 'exists:accesos,id'],
        'tipo' => ['required', 'in:seguridad,acceso,equipamiento,comportamiento,otro'],
        'prioridad' => ['required', 'in:alta,media,baja'],
        'descripcion' => ['required', 'string', 'max:1000'],
    ]);

    $user = Auth::guard('system')->user();

    Incidencia::create([
        'acceso_id' => $validated['acceso_id'],
        'tipo' => $validated['tipo'],
        'prioridad' => $validated['prioridad'],
        'descripcion' => $validated['descripcion'],
        'reportado_por' => $user->idUsuario,
    ]);

    return back()->with('success', 'Incidencia reportada exitosamente.');
}
```

---

### **3. Rutas**
**Archivo**: `routes/web.php`

**Rutas agregadas** (dentro del grupo `celador`):
```php
// Incidencias
Route::get('/incidencias', [CeladorIncidenciaController::class, 'index'])->name('incidencias.index');
Route::post('/incidencias', [CeladorIncidenciaController::class, 'store'])->name('incidencias.store');
Route::get('/incidencias/accesos-activos', [CeladorIncidenciaController::class, 'getAccesosActivos'])->name('incidencias.accesos-activos');
```

---

## üé® Caracter√≠sticas del Modal

### **Dise√±o Visual:**

#### **1. Selecci√≥n de Prioridad (Radio Buttons Visuales)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ    ‚ÑπÔ∏è    ‚îÇ    ‚ö†Ô∏è    ‚îÇ    üö®    ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  Baja   ‚îÇ  Media  ‚îÇ  Alta   ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ   Verde     Amarillo    Rojo              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Colores**:
- **Baja**: Verde #39A900 (SENA)
- **Media**: Amarillo #FDC300
- **Alta**: Rojo #dc2626

**Interacci√≥n**:
- Hover: Borde del color correspondiente
- Seleccionado: Fondo coloreado + borde grueso
- Iconos diferenciados por prioridad

#### **2. Tipos de Incidencia con Iconos**
```
üõ°Ô∏è Seguridad       - Problemas de seguridad general
üîë Acceso          - Problemas con entrada/salida
üîß Equipamiento    - Fallas en port√°tiles/veh√≠culos
üë§ Comportamiento  - Conductas inapropiadas
üìã Otro            - Cualquier otro tipo
```

#### **3. Accesos Activos Detallados**
```
Formato del select:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Juan P√©rez - 14 oct, 06:02 PM | üíª      ‚îÇ
‚îÇ Mar√≠a Garc√≠a - 14 oct, 03:15 PM | üöó    ‚îÇ
‚îÇ Pedro L√≥pez - 14 oct, 05:30 PM | üíª üöó  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ Validaciones Implementadas

### **Frontend (Vue):**
- ‚úÖ Acceso: requerido
- ‚úÖ Tipo: requerido
- ‚úÖ Prioridad: requerido (prellenado en "media")
- ‚úÖ Descripci√≥n: requerido

### **Backend (PHP):**
- ‚úÖ `acceso_id`: requerido, debe existir en tabla accesos
- ‚úÖ `tipo`: requerido, debe ser uno de los 5 tipos v√°lidos
- ‚úÖ `prioridad`: requerido, debe ser alta, media o baja
- ‚úÖ `descripcion`: requerido, m√°ximo 1000 caracteres
- ‚úÖ `reportado_por`: se obtiene autom√°ticamente del usuario autenticado

---

## üß™ C√≥mo Probar

### **Paso 1**: Ir a la p√°gina de incidencias
```
http://127.0.0.1:8000/system/celador/incidencias
```

### **Paso 2**: Click en "Nueva Incidencia" (bot√≥n rojo)
```
‚úÖ Se abre el modal
‚úÖ Se cargan los accesos activos
‚úÖ Prioridad prellenada en "Media"
```

### **Paso 3**: Seleccionar un acceso activo
```
Ejemplo: Juan P√©rez - 14 oct, 06:02 PM | üíª
(Debe haber al menos un acceso en estado "activo")
```

### **Paso 4**: Seleccionar tipo
```
Ejemplo: üõ°Ô∏è Seguridad
```

### **Paso 5**: Seleccionar prioridad
```
Click en el bot√≥n:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   üö®    ‚îÇ
‚îÇ  ALTA   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Paso 6**: Escribir descripci√≥n
```
Ejemplo: "Se detect√≥ a una persona intentando ingresar 
con identificaci√≥n falsa. Se solicit√≥ documentaci√≥n 
adicional y se neg√≥ el acceso."
```

### **Paso 7**: Click en "Reportar Incidencia"
```
‚úÖ Se valida el formulario
‚úÖ Se crea la incidencia
‚úÖ Se cierra el modal
‚úÖ La tabla se actualiza autom√°ticamente
‚úÖ Aparece el nuevo registro en la tabla
```

---

## üìä Ejemplo de Uso

### **Escenario**: Reportar incidencia de seguridad

**Datos ingresados:**
```
Acceso: Juan P√©rez - 14 oct, 06:02 PM | üíª
Tipo: üõ°Ô∏è Seguridad
Prioridad: üö® Alta
Descripci√≥n: "Persona intent√≥ ingresar con documentaci√≥n 
              falsificada. Se neg√≥ el acceso y se report√≥ 
              a seguridad."
```

**Resultado en la tabla:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Prioridad ‚îÇ Persona      ‚îÇ Tipo     ‚îÇ Descripci√≥n        ‚îÇ Reportado por    ‚îÇ Fecha  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üö® Alta  ‚îÇ Juan P√©rez   ‚îÇüõ°Ô∏è Seg... ‚îÇ Persona intent√≥... ‚îÇ Admin Principal  ‚îÇ 14 oct ‚îÇ
‚îÇ    Rojo   ‚îÇ              ‚îÇ          ‚îÇ                    ‚îÇ (Administrador)  ‚îÇ 8:07PM ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Casos de Uso

### **1. Incidencia de Seguridad (Alta prioridad)**
```
Acceso: Juan P√©rez
Tipo: üõ°Ô∏è Seguridad
Prioridad: üö® Alta
Descripci√≥n: "Intento de acceso con documento falso"
```

### **2. Incidencia de Comportamiento (Media prioridad)**
```
Acceso: Mar√≠a Garc√≠a
Tipo: üë§ Comportamiento
Prioridad: ‚ö†Ô∏è Media
Descripci√≥n: "Persona con actitud agresiva en el ingreso"
```

### **3. Incidencia de Equipamiento (Baja prioridad)**
```
Acceso: Pedro L√≥pez
Tipo: üîß Equipamiento
Prioridad: ‚ÑπÔ∏è Baja
Descripci√≥n: "Port√°til sin etiqueta de identificaci√≥n visible"
```

### **4. Incidencia de Acceso**
```
Acceso: Ana Rodr√≠guez
Tipo: üîë Acceso
Prioridad: ‚ö†Ô∏è Media
Descripci√≥n: "Intent√≥ ingresar fuera del horario autorizado"
```

---

## üîê Seguridad

### **Registro Autom√°tico del Reportador:**
```php
$user = Auth::guard('system')->user();
'reportado_por' => $user->idUsuario
```
- ‚úÖ Se registra autom√°ticamente qui√©n reporta
- ‚úÖ Trazabilidad completa de incidencias
- ‚úÖ No se puede falsificar el reportador

### **Validaci√≥n de Acceso:**
- ‚úÖ El acceso debe existir en la base de datos
- ‚úÖ El acceso debe estar en estado "activo"
- ‚úÖ No se pueden crear incidencias para accesos inexistentes

---

## üé® Estados Visuales

### **Bot√≥n "Nueva Incidencia":**
- Color: Rojo #dc2626
- Hover: Rojo m√°s oscuro #b91c1c
- Icono: ‚ö†Ô∏è Alert Triangle
- Responsive: Texto completo en desktop, solo "Nueva" en m√≥vil

### **Prioridades (Botones Radiales):**

**Baja** (Verde):
```css
color: #39A900
background: #39A900/10
border: 2px #39A900
icon: ‚ÑπÔ∏è info
```

**Media** (Amarillo):
```css
color: #FDC300
background: #FDC300/10
border: 2px #FDC300
icon: ‚ö†Ô∏è alert-circle
```

**Alta** (Rojo):
```css
color: #dc2626
background: #dc2626/10
border: 2px #dc2626
icon: üö® alert-triangle
```

### **Modal:**
- Fondo semi-transparente
- Animaci√≥n suave
- M√°ximo ancho: 2xl (~672px)
- Padding: 24px

---

## ‚ú® Mejoras Implementadas

1. ‚úÖ **Carga autom√°tica de accesos**: Solo muestra accesos activos
2. ‚úÖ **Prioridad visual**: Botones con colores en lugar de select
3. ‚úÖ **Iconos informativos**: Cada tipo tiene su icono
4. ‚úÖ **Descripci√≥n amplia**: Textarea de 4 l√≠neas
5. ‚úÖ **Mensaje informativo**: Explica el proceso claramente
6. ‚úÖ **Estados de carga**: Loading mientras carga accesos
7. ‚úÖ **Auto-refresh**: Tabla se actualiza sin recargar
8. ‚úÖ **Responsive completo**: Funciona en todos los dispositivos

---

## üêõ Manejo de Errores

### **Si no hay accesos activos:**
```
Select muestra: "Seleccionar acceso..."
Mensaje: "No hay accesos activos en este momento"
```

### **Si hay error de validaci√≥n:**
```
‚úÖ Mensaje de error espec√≠fico debajo de cada campo
‚úÖ Modal permanece abierto
‚úÖ Datos ingresados se conservan
```

### **Si falla la creaci√≥n:**
```
‚úÖ Mensaje de error general
‚úÖ Usuario puede reintentar
‚úÖ Datos del formulario se mantienen
```

---

## üìù Resumen de Cambios

### **Frontend:**
- ‚úÖ Bot√≥n "Nueva Incidencia" rojo en header
- ‚úÖ Modal completo con dise√±o profesional
- ‚úÖ Carga din√°mica de accesos activos
- ‚úÖ Selecci√≥n visual de prioridad
- ‚úÖ Validaciones y feedback visual

### **Backend:**
- ‚úÖ M√©todo `store()` para crear incidencia
- ‚úÖ M√©todo `getAccesosActivos()` para API
- ‚úÖ Validaciones robustas
- ‚úÖ Registro autom√°tico del reportador

### **Rutas:**
- ‚úÖ POST `/system/celador/incidencias` ‚Üí store
- ‚úÖ GET `/system/celador/incidencias/accesos-activos` ‚Üí getAccesosActivos

---

## üéâ Resultado Final

**Antes**:
- ‚ùå Solo se pod√≠an ver incidencias
- ‚ùå No hab√≠a forma de crear desde la interfaz

**Ahora**:
- ‚úÖ **Bot√≥n "Nueva Incidencia" visible** (rojo)
- ‚úÖ **Modal profesional y funcional**
- ‚úÖ **Prioridad visual con colores**
- ‚úÖ **Carga din√°mica de accesos activos**
- ‚úÖ **Validaciones robustas**
- ‚úÖ **Trazabilidad completa** (qui√©n reporta)
- ‚úÖ **Experiencia consistente** con otros m√≥dulos

---

**Fecha de implementaci√≥n**: 14/10/2025  
**Estado**: ‚úÖ **COMPLETAMENTE FUNCIONAL**  
**Versi√≥n**: CTAccess v2.0  
**M√≥dulo**: Incidencias
